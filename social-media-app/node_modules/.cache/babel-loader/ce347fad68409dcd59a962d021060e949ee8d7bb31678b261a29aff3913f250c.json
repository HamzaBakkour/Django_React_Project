{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/alexa/OneDrive/Programming/FULL_STACK_DJANGO_AND_REACT/Chapter_1/social-media-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/alexa/OneDrive/Programming/FULL_STACK_DJANGO_AND_REACT/Chapter_1/social-media-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import axios from\"axios\";import createAuthRefreshInterceptor from\"axios-auth-refresh\";import{getAccessToken,getRefreshToken,getUser}from\"../hooks/user.actions\";var base=\"ec2-16-170-201-40.eu-north-1.compute.amazonaws.com\";var axiosService=axios.create({baseURL:base,headers:{\"Content-Type\":\"application/json\"}});console.log(\"axiosService: \",axiosService);console.log(\"baseURL: \",base);axiosService.interceptors.request.use(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(config){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:/**\r\n   * Retrieving the access and refresh tokens from the local storage\r\n   */config.headers.Authorization=\"Bearer \".concat(getAccessToken());return _context.abrupt(\"return\",config);case 2:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());axiosService.interceptors.response.use(function(res){return Promise.resolve(res);},function(err){return Promise.reject(err);});var refreshAuthLogic=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(failedRequest){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\",axios.post(\"/auth/refresh/\",{refresh:getRefreshToken()},{baseURL:base}).then(function(resp){var access=resp.data.access;failedRequest.response.config.headers[\"Authorization\"]=\"Bearer \"+access;localStorage.setItem(\"auth\",JSON.stringify({access:access,refresh:getRefreshToken(),user:getUser()}));}).catch(function(){localStorage.removeItem(\"auth\");}));case 1:case\"end\":return _context2.stop();}},_callee2);}));return function refreshAuthLogic(_x2){return _ref2.apply(this,arguments);};}();createAuthRefreshInterceptor(axiosService,refreshAuthLogic);export function fetcher(url){return axiosService.get(url).then(function(res){return res.data;});}export default axiosService;","map":{"version":3,"names":["axios","createAuthRefreshInterceptor","getAccessToken","getRefreshToken","getUser","base","axiosService","create","baseURL","headers","console","log","interceptors","request","use","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","config","wrap","_callee$","_context","prev","next","Authorization","concat","abrupt","stop","_x","apply","arguments","response","res","Promise","resolve","err","reject","refreshAuthLogic","_ref2","_callee2","failedRequest","_callee2$","_context2","post","refresh","then","resp","access","data","localStorage","setItem","JSON","stringify","user","catch","removeItem","_x2","fetcher","url","get"],"sources":["C:/Users/alexa/OneDrive/Programming/FULL_STACK_DJANGO_AND_REACT/Chapter_1/social-media-app/src/helpers/axios.js"],"sourcesContent":["import axios from \"axios\";\r\nimport createAuthRefreshInterceptor from \"axios-auth-refresh\";\r\nimport {\r\n  getAccessToken,\r\n  getRefreshToken,\r\n  getUser,\r\n} from \"../hooks/user.actions\";\r\n\r\nconst base = \"ec2-16-170-201-40.eu-north-1.compute.amazonaws.com\";\r\n\r\nconst axiosService = axios.create({\r\n  baseURL: base,\r\n  headers: {\r\n    \"Content-Type\": \"application/json\",\r\n  },\r\n});\r\n\r\nconsole.log(\"axiosService: \", axiosService);\r\nconsole.log(\"baseURL: \", base);\r\n\r\n\r\naxiosService.interceptors.request.use(async (config) => {\r\n  /**\r\n   * Retrieving the access and refresh tokens from the local storage\r\n   */\r\n  config.headers.Authorization = `Bearer ${getAccessToken()}`;\r\n  return config;\r\n});\r\n\r\naxiosService.interceptors.response.use(\r\n  (res) => Promise.resolve(res),\r\n  (err) => Promise.reject(err)\r\n);\r\n\r\nconst refreshAuthLogic = async (failedRequest) => {\r\n  return axios\r\n    .post(\r\n      \"/auth/refresh/\",\r\n      {\r\n        refresh: getRefreshToken(),\r\n      },\r\n      {\r\n        baseURL: base,\r\n      }\r\n    )\r\n    .then((resp) => {\r\n      const { access } = resp.data;\r\n      failedRequest.response.config.headers[\"Authorization\"] =\r\n        \"Bearer \" + access;\r\n      localStorage.setItem(\r\n        \"auth\",\r\n        JSON.stringify({ access, refresh: getRefreshToken(), user: getUser() })\r\n      );\r\n    })\r\n    .catch(() => {\r\n      localStorage.removeItem(\"auth\");\r\n    });\r\n};\r\n\r\ncreateAuthRefreshInterceptor(axiosService, refreshAuthLogic);\r\n\r\nexport function fetcher(url) {\r\n  return axiosService.get(url).then((res) => res.data);\r\n}\r\n\r\nexport default axiosService;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}